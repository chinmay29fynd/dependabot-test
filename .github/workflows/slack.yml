name: Dependabot PR Alerts

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: read
  security-events: read

jobs:
  dependabot:
    runs-on: ubuntu-latest
    if: github.event.pull_request.user.login == 'dependabot[bot]'
    steps:
      - name: Dependabot metadata
        id: dependabot-metadata
        uses: dependabot/fetch-metadata@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          alert-lookup: true
          compat-lookup: true
          
      - name: Notify Slack about Dependabot PR
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          channel: '#test-dep-bot'
          text: |
            ğŸš¨ *Dependabot Security Update*
            
            *Repository:* ${{ github.repository }}
            *PR Number:* #${{ github.event.pull_request.number }}
            *Branch:* ${{ github.event.pull_request.head.ref }}
            
            *ğŸ“¦ Dependencies Updated:*
            ${{ steps.dependabot-metadata.outputs.dependency-names }}
            
            *ğŸ”§ Update Details:*
            â€¢ *Type:* ${{ steps.dependabot-metadata.outputs.dependency-type }}
            â€¢ *Update Type:* ${{ steps.dependabot-metadata.outputs.update-type || 'Version update' }}
            â€¢ *Package Ecosystem:* ${{ steps.dependabot-metadata.outputs.package-ecosystem }}
            â€¢ *Directory:* ${{ steps.dependabot-metadata.outputs.directory }}
            â€¢ *Target Branch:* ${{ steps.dependabot-metadata.outputs.target-branch }}
            
            *ğŸ”„ Version Changes:*
            ${{ steps.dependabot-metadata.outputs.previous-version && format('â€¢ *From:* {0}', steps.dependabot-metadata.outputs.previous-version) || '' }}
            ${{ steps.dependabot-metadata.outputs.new-version && format('â€¢ *To:* {0}', steps.dependabot-metadata.outputs.new-version) || '' }}
            
            *ğŸ›¡ï¸ Security Information:*
            ${{ steps.dependabot-metadata.outputs.alert-state == 'OPEN' && 'ğŸš¨ *SECURITY ALERT DETECTED*' || 'ğŸ›¡ï¸ *Security vulnerability fix*' }}
            ${{ steps.dependabot-metadata.outputs.alert-state && format('â€¢ *Alert State:* {0}', steps.dependabot-metadata.outputs.alert-state) || '' }}
            ${{ steps.dependabot-metadata.outputs.ghsa-id && format('â€¢ *GHSA ID:* {0}', steps.dependabot-metadata.outputs.ghsa-id) || '' }}
            ${{ steps.dependabot-metadata.outputs.cvss && steps.dependabot-metadata.outputs.cvss != '0' && format('â€¢ *CVSS Score:* {0}', steps.dependabot-metadata.outputs.cvss) || '' }}
            
            *ğŸ“ˆ Compatibility:*
            ${{ steps.dependabot-metadata.outputs.compatibility-score && steps.dependabot-metadata.outputs.compatibility-score != '0' && format('â€¢ *Compatibility Score:* {0}', steps.dependabot-metadata.outputs.compatibility-score) || '' }}
            
            *ğŸ“‹ Summary:*
            Updates ${{ steps.dependabot-metadata.outputs.dependency-names }} to fix security vulnerabilities and improve dependency health.
            
            <${{ github.event.pull_request.html_url }}|View Dependabot PR>
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }} 