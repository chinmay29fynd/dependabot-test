name: Dependabot PR Alerts

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: read
  security-events: read

jobs:
  dependabot:
    runs-on: ubuntu-latest
    if: github.event.pull_request.user.login == 'dependabot[bot]'
    steps:
      - name: Dependabot metadata
        id: dependabot-metadata
        uses: dependabot/fetch-metadata@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Notify Slack about Dependabot PR
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          channel: '#test-dep-bot'
          text: |
            ğŸš¨ *Dependabot Security Update*
            
            *Repository:* ${{ github.repository }}
            *PR Number:* ${{ github.event.pull_request.number }}
            *Dependencies:* ${{ steps.dependabot-metadata.outputs.dependency-names }}
            *Dependency Type:* ${{ steps.dependabot-metadata.outputs.dependency-type }}
            *Update Type:* ${{ steps.dependabot-metadata.outputs.update-type || 'Security update' }}
            
            ${{ steps.dependabot-metadata.outputs.alert-state == 'OPEN' && 'ğŸš¨ *SECURITY ALERT DETECTED*' || 'ğŸ›¡ï¸ *Security vulnerability fix*' }}
            ${{ steps.dependabot-metadata.outputs.ghsa-id && format('*GHSA ID:* {0}', steps.dependabot-metadata.outputs.ghsa-id) || '' }}
            ${{ steps.dependabot-metadata.outputs.cvss && steps.dependabot-metadata.outputs.cvss != '0' && format('*CVSS Score:* {0}', steps.dependabot-metadata.outputs.cvss) || '' }}
            
            *Changes:* Updates dependencies to fix security vulnerabilities
            
            <${{ github.event.pull_request.html_url }}|View Dependabot PR>
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }} 